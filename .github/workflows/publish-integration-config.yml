name: Publish GitLab Integration Config

concurrency:
  group: gitlab-enterprise-connector-${{ github.ref }}
  cancel-in-progress: true

on:
  workflow_dispatch:

env:
  ACTION_URL: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}

jobs:
  publish:
    name: Build
    runs-on: ubuntu-latest
    outputs:
      image-tag: ${{ steps.build-and-deploy.outputs.tag }}

    steps:
      - name: Checkout Git Repository üïù
        uses: actions/checkout@v2

      - name: LeanIX Secrets üîí
        uses: leanix/secrets-action@master
        with:
          secret-store-credentials: ${{ secrets.INJECTED_SECRET_STORE_CREDENTIALS }}

      - name: Publish integration configuration
        id: vsm_integration_config
        uses: leanix/vsm-discovery-publish-action@main

        with:
          integration-json: integration-configuration/integration-configuration.json
          assets-folder: integration-configuration/images